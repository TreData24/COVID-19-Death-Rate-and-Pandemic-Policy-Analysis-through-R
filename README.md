# **COVID‑19 Death Rate & Pandemic Policy Analysis**

This repo contains an R workflow that aggregates **COVID‑19 mortality (Level 1)** and **policy/vaccination measures (Level 3)** from the `COVID19` R package, cleans and merges them, and produces visualizations and models exploring how policy strength and vaccination coverage relate to **deaths per million** across countries.

## What this project does

*   **Load & prepare data** from the `COVID19` package (Levels 1 & 3).
*   **Compute metrics**: deaths per million, vaccine coverage, and a composite policy score.
*   **Select cohorts**: top and bottom countries by mortality.
*   **Visualize trends**:
    *   Mortality comparison (bar chart).
    *   7‑day average mortality time series (Top vs Bottom) with **variant markers**.
    *   Bubble chart: **Policy strength** vs **deaths per million** (bubble = vaccination coverage).
    *   Policy strength comparison (bar chart).
    *   Scatterplot: **vaccine coverage** vs **deaths per million** with linear fit.
    *   Regression coefficient plot with **95% CIs**.
    *   **ROC curve** for a simple mortality classifier (Top10 vs Bottom10).
*   **Modeling**:
    *   Linear regression on log(deaths per million) using standardized predictors.
    *   Logistic regression classifier for high vs low mortality groups and **AUC**.

## Requirements

*   **R** ≥ 4.2 (recommended)
*   R packages:
    *   `COVID19`, `dplyr`, `ggplot2`, `lubridate`, `zoo`, `broom`, `pROC`, `fmsb`, `scales`

Install packages:

```r
install.packages(c(
  "COVID19", "dplyr", "ggplot2", "lubridate",
  "zoo", "broom", "pROC", "fmsb", "scales"
))
```

> *Tip:* Consider using `renv` to snapshot dependencies:

```r
install.packages("renv")
renv::init()      # creates a reproducible environment
```

## Quick Start

1.  **Clone** this repository.
2.  **Open** `analysis.R` or paste the provided code into a new R script/RMarkdown.
3.  **Run** the script in R or via command line:
    ```bash
    Rscript analysis.R
    ```
4.  As the script runs, it will print basic data exploration summaries and produce plots in your R graphics device (or RMarkdown output).

## Key Objects & Steps

*   **Step 1: Load Packages**
    ```r
    library(COVID19); library(dplyr); library(ggplot2); library(lubridate)
    library(zoo); library(broom); library(pROC); library(fmsb); library(scales)
    ```

*   **Step 2: Aggregation & Merge**
    *   `lvl1` / `lvl1_totals`: Level 1 mortality & population → `deaths_per_million`
    *   `lvl3` / `lvl3_totals`: Level 3 vaccination & policies
    *   `merged`: `inner_join` of Level 1 & 3 with:
        ```r
        vaccine_coverage = (vaccines / population) * 100
        log_deaths_per_million = log(deaths_per_million)
        ```

*   **Step 3: Cleaning**
    *   Keep countries with `population > 1e6` and `deaths > 100`
    *   Replace missing policy fields with `0`
    *   Remove infinite logs and deduplicate by `iso_alpha_3`
    *   Output: `model_df`

*   **Step 4: Top vs Bottom Mortality**
    *   `top10`, `bottom10`, combined into `combined` with `group = "Top10"/"Bottom10"`
    *   Build daily time series and 7‑day rolling mean: `ts_plot_df`

*   **Step 5: Visualizations**
    *   Mortality bar chart (`combined`)
    *   Time series lines (`ts_top10`, `ts_bottom10`) + **Alpha/Delta/Omicron** markers
    *   Bubble chart: policy strength vs deaths per million (`bubble_df`)
    *   Policy strength bars (`policy_plot_df`)
    *   Scatterplot: coverage vs deaths per million

*   **Step 6: Regression**
    *   Build `reg_data`, standardize predictors, fit:
        ```r
        lm(log_deaths_per_million ~ z_vaccine_coverage +
                                   z_internal_movement_restrictions +
                                   z_elderly_people_protection)
        ```
    *   Plot coefficients with **95% CIs**.

*   **Step 8: Classification + ROC**
    *   Logistic regression on `high_mortality` (Top10 = 1, Bottom10 = 0)
    *   Safe ROC computation and AUC display.

## Outputs (generated by the script)

*   **COVID‑19 Mortality: Top vs Bottom Countries** (bar chart)
*   **7‑Day Avg Mortality — Top Countries** (line chart with variant markers)
*   **7‑Day Avg Mortality — Bottom Countries** (line chart with variant markers)
*   **Policy Strength vs Mortality** (bubble chart, bubble size = vaccination coverage)
*   **Policy Scores by Country** (bar chart)
*   **Regression Coefficients (95% CI)** (point + error bars)
*   **Deaths per Million vs Vaccine Coverage** (scatter + linear fit)
*   **ROC Curve: Mortality Classifier** (+ printed **AUC**)

> All plots render to the active graphics device (RStudio, R GUI, or RMarkdown output).\
> Console prints include dataset dimensions and row counts after cleaning.

## Configuration & Tunables

*   **Cohort filters**:\
    Edit in **Step 3**:
    ```r
    filter(population > 1e6, deaths > 100)
    ```
*   **Variant markers** (Step 5):\
    Modify `variant_dates` to adjust vertical lines and labels:
    ```r
    variant_dates <- data.frame(
      date = as.Date(c("2020-11-15", "2021-04-01", "2021-11-25")),
      label = c("Alpha Emerges", "Delta Emerges", "Omicron Emerges")
    )
    ```
*   **Policy strength**:\
    Defined as the sum of `vaccination_policy + internal_movement_restrictions + elderly_people_protection`.

## Notes & Troubleshooting

*   **Infinite / missing values**:\
    The script replaces `Inf` metrics with safe defaults and drops `NA` logs to avoid crashes during modeling.
*   **Join warnings** (`inner_join` many‑to‑many):\
    If you see a dplyr warning about many‑to‑many joins when creating `ts_plot_df`, it’s expected because each country appears in multiple time points. You can silence by:
    ```r
    ts_plot_df <- ts_daily %>%
      inner_join(combined %>% select(iso_alpha_3, group),
                 by = "iso_alpha_3", relationship = "many-to-many")
    ```
    or pre‑deduplicate keys as needed.
*   **Plot scales**:\
    Time series use a **7‑day moving average** (`zoo::rollmean`) which may drop leading/trailing points; warnings about removed rows are normal.

## Acknowledgments

*   Data sourced via the **`COVID19` R package** (CRAN) and its integrated feeds.
*   Modeling & visualization rely on open‑source R libraries listed above.

## Next Steps

*   Save this README to `README.md`.
*   Optionally convert your script into **RMarkdown** (`.Rmd`) to knit an HTML report with embedded plots.
*   Add a `Makefile` or a small `run.R` to streamline execution.
